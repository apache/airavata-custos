---
- hosts: ome
  connection: local
  gather_facts: false
  name: "OME - Ansible Modules"

  collections:
    - dellemc.openmanage

  tasks:

  - name: "Retrieve baseline information for specific device ids."
    ome_firmware_baseline_compliance_info:
      hostname: "{{ hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      device_ids:
        - 11111
        - 11112
    register: result

    tags:
      - overall-compliance-report

  - name: "Firmware baseline compliance info based on FirmwareStatus - Non-Compliant"
    set_fact:
      non_compliance_fact: "{{ item }}"
    when:
      - item.DeviceComplianceReports.0.FirmwareStatus=='Non-Compliant'
    with_items:
      - "{{ result.baseline_compliance_info }}"
    loop_control:
      label: "{{ item.Name }} - {{ item.DeviceComplianceReports.0.FirmwareStatus }}"

    tags:
      - non-compliance-report

  - name: "Firmware baseline compliance info based on Device ID"
    set_fact:
      device_fact: "{{ item }}"
    when:
      - item.DeviceComplianceReports.0.DeviceId==11111
    with_items:
      - "{{ result.baseline_compliance_info }}"
    loop_control:
      label: "{{ item.Name }} - {{ item.DeviceComplianceReports.0.DeviceId }}"

    tags:
      - device-id-report

  - name: "Firmware baseline compliance info based on Device Service Tag"
    set_fact:
      service_tag_fact: "{{ item }}"
    when:
      - item.DeviceComplianceReports.0.ServiceTag=='1X1X1'
    with_items:
      - "{{ result.baseline_compliance_info }}"
    loop_control:
      label: "{{ item.Name }} - {{ item.DeviceComplianceReports.0.ServiceTag }}"

    tags:
      - device-service-tag-report