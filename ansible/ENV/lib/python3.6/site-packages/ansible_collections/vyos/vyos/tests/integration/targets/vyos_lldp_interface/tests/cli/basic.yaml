---
- debug: msg="START cli/basic.yaml on connection={{ ansible_connection }}"

- name: Make sure LLDP is not running before tests
  vyos.vyos.vyos_config:
    lines: delete service lldp

- name: Create LLDP configuration
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: present

- assert:
    that:
      - result.changed == true
      - '"set service lldp interface eth1" in result.commands'

- name: Create LLDP configuration again (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: present

- assert:
    that:
      - result.changed == false

- name: Disable LLDP configuration
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: disabled

- assert:
    that:
      - result.changed == true
      - '"set service lldp interface eth1 disable" in result.commands'

- name: Disable LLDP configuration again (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: disabled

- assert:
    that:
      - result.changed == false

- name: Enable LLDP configuration
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: enabled

- assert:
    that:
      - result.changed == true
      - '"delete service lldp interface eth1 disable" in result.commands'

- name: Enable LLDP configuration again (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: enabled

- assert:
    that:
      - result.changed == false

- name: Delete LLDP configuration
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: absent

- assert:
    that:
      - result.changed == true
      - '"delete service lldp interface eth1" in result.commands'

- name: Delete LLDP configuration again (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    name: eth1
    state: absent

- assert:
    that:
      - result.changed == false

- name: Create aggregate of LLDP interface configurations
  register: result
  vyos.vyos.vyos_lldp_interface:
    aggregate:

      - name: eth1

      - name: eth2
    state: present

- assert:
    that:
      - result.changed == true
      - '"set service lldp interface eth1" in result.commands'
      - '"set service lldp interface eth2" in result.commands'

- name: Create aggregate of LLDP interface configurations again (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    aggregate:

      - name: eth1

      - name: eth2
    state: present

- assert:
    that:
      - result.changed == false

- name: Override LLDP interface configuration on aggregate
  register: result
  vyos.vyos.vyos_lldp_interface:
    aggregate:

      - name: eth1

      - name: eth2
        state: disabled
    state: present

- assert:
    that:
      - result.changed == true
      - '"set service lldp interface eth2 disable" in result.commands'

- name: Override LLDP interface configuration on aggregate again (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    aggregate:

      - name: eth1

      - name: eth2
        state: disabled
    state: present

- assert:
    that:
      - result.changed == false

- name: Delete aggregate of LLDP interface configurations
  register: result
  vyos.vyos.vyos_lldp_interface:
    aggregate:

      - name: eth1

      - name: eth2
    state: absent

- assert:
    that:
      - result.changed == true
      - '"delete service lldp interface eth1" in result.commands'
      - '"delete service lldp interface eth2" in result.commands'

- name: Delete aggregate of LLDP interface configurations (idempotent)
  register: result
  vyos.vyos.vyos_lldp_interface:
    aggregate:

      - name: eth1

      - name: eth2
    state: absent

- assert:
    that:
      - result.changed == false
