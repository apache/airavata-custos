---
- debug: msg="START ios_smoke cli/misc_tests.yaml on connection={{ ansible_connection }}"

# hit network.ios.ios- get_defaults_flag()
- name: setup
  cisco.ios.ios_config:
    commands:
      - no description
      - shutdown
    parents:
      - interface Loopback999
    match: none
    provider: "{{ cli }}"

- name: configure device with defaults included
  cisco.ios.ios_config:
    src: defaults/config.j2
    defaults: true
    provider: "{{ cli }}"
  register: result

- name: run ios commands to test command_timeout
  cisco.ios.ios_command:
    commands:
      - show running-config all
      - show interfaces
      - show running-config all
  vars:
    ansible_command_timeout: 1
    ansible_buffer_read_timeout: 2
  ignore_errors: true
  register: result
  when: ansible_connection == 'network_cli'

- assert:
    that:
      - 'result.failed == true'
      - "'timeout value 1 seconds reached' in result.msg"
  when: ansible_connection == 'network_cli'

- debug: msg="END ios_smoke cli/misc_tests.yaml on connection={{ ansible_connection }}"
