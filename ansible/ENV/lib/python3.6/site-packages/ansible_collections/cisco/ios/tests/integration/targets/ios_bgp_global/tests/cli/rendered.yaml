---
- debug:
    msg: Start ios_bgp_global rendered integration tests ansible_connection={{
      ansible_connection }}

- block:
    - name: Render the commands for provided  configuration
      register: result
      cisco.ios.ios_bgp_global: &id001
        config:
          as_number: 65000
          bgp:
            advertise_best_external: true
            bestpath:
              - compare_routerid: true
            dampening:
              penalty_half_time: 1
              reuse_route_val: 1
              suppress_route_val: 1
              max_suppress: 1
            graceful_shutdown:
              neighbors:
                time: 50
              community: 100
              local_preference: 100
            log_neighbor_changes: true
            nopeerup_delay:
              - post_boot: 10
          neighbor:
            - address: 198.51.100.1
              description: merge neighbor
              remote_as: 100
              aigp:
                send:
                  cost_community:
                    id: 100
                    poi:
                      igp_cost: true
                      transitive: true
              route_map:
                name: test-route
                out: true
          redistribute:
            - connected:
                metric: 10
          timers:
            keepalive: 100
            holdtime: 200
            min_holdtime: 150
        state: rendered

    - assert:
        that:
          - result.changed == false
          - result.rendered|symmetric_difference(merged.commands) == []
